{"ast":null,"code":"import React,{useState,useEffect,useCallback,useMemo}from'react';import{Box,AppBar,Toolbar,Typography,IconButton,Alert,Snackbar,useTheme,useMediaQuery}from'@mui/material';import{Menu as MenuIcon,ZoomIn,ZoomOut,NavigateBefore,NavigateNext}from'@mui/icons-material';import{PDFViewer}from'./PDFViewer';import{ThumbnailSidebar}from'./ThumbnailSidebar';import{PDFService}from'../../services/pdfService';import{FormFieldService}from'../../services/formFieldService';import{WizardButton}from'../wizard/WizardButton';import{ProgressTracker}from'../ui/ProgressTracker';import{useForm}from'../../contexts/FormContext';import{useWizard}from'../../contexts/WizardContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const PDFFormContainer=_ref=>{let{className}=_ref;const theme=useTheme();const isMobile=useMediaQuery(theme.breakpoints.down('md'));const formContext=useForm();const wizard=useWizard();// PDF state\nconst[pdfDoc,setPdfDoc]=useState(null);const[currentPage,setCurrentPage]=useState(1);const[scale,setScale]=useState(1.0);const[sidebarOpen,setSidebarOpen]=useState(!isMobile);// Form tracking state\nconst[completedPages,setCompletedPages]=useState(new Set());const[pagesWithFormFields,setPagesWithFormFields]=useState(new Set());// UI state\nconst[error,setError]=useState(null);const[snackbarMessage,setSnackbarMessage]=useState('');// Get PDF URL from environment or URL parameters (memoized to prevent re-renders)\nconst pdfUrl=useMemo(()=>PDFService.getDefaultPDFUrl(),[]);// Handle document load\nconst handleDocumentLoad=useCallback(async document=>{setPdfDoc(document);setCurrentPage(1);console.log(`PDF document loaded: ${document.numPages} pages`);try{// Extract all form fields from the document\nconst allFormFields=await FormFieldService.extractAllFormFields(document);// Initialize form context with extracted fields\nformContext.initializeFields(allFormFields);// Initialize wizard with form fields\nwizard.initializeWizard(allFormFields);// Track pages with form fields\nconst pagesWithForms=new Set();allFormFields.forEach(field=>{pagesWithForms.add(field.page);});setPagesWithFormFields(pagesWithForms);// Show status message\nif(allFormFields.length>0){const categories=FormFieldService.categorizeFields(allFormFields);setSnackbarMessage(`Found ${categories.required.length} required fields and ${categories.signature.length} signatures across ${pagesWithForms.size} page(s)`);}else{setSnackbarMessage('No form fields found in this PDF');}}catch(error){console.error('Failed to extract form fields:',error);setSnackbarMessage('Error extracting form fields from PDF');}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);// Remove dependencies to prevent reloading\n// Handle page load\nconst handlePageLoad=useCallback(page=>{console.log(`Page ${page.pageNumber} loaded and rendered`);},[]);// Handle PDF errors\nconst handleError=useCallback(error=>{setError(error);console.error('PDF error:',error);},[]);// Navigation handlers\nconst handlePageSelect=useCallback(pageNumber=>{if(pdfDoc&&pageNumber>=1&&pageNumber<=pdfDoc.numPages){setCurrentPage(pageNumber);// Auto-close sidebar on mobile after selection\nif(isMobile){setSidebarOpen(false);}}},[pdfDoc,isMobile]);const handlePreviousPage=useCallback(()=>{if(currentPage>1){setCurrentPage(currentPage-1);}},[currentPage]);const handleNextPage=useCallback(()=>{if(pdfDoc&&currentPage<pdfDoc.numPages){setCurrentPage(currentPage+1);}},[pdfDoc,currentPage]);// Zoom handlers\nconst handleZoomIn=useCallback(()=>{setScale(prevScale=>Math.min(prevScale*1.25,3.0));},[]);const handleZoomOut=useCallback(()=>{setScale(prevScale=>Math.max(prevScale/1.25,0.5));},[]);// Toggle sidebar\nconst handleToggleSidebar=useCallback(()=>{setSidebarOpen(!sidebarOpen);},[sidebarOpen]);// Cleanup on unmount\nuseEffect(()=>{return()=>{if(pdfUrl){PDFService.cleanup(pdfUrl);}};},[pdfUrl]);// Close error alert\nconst handleCloseError=()=>{setError(null);};// Close snackbar\nconst handleCloseSnackbar=()=>{setSnackbarMessage('');};return/*#__PURE__*/_jsxs(Box,{className:className,sx:{height:'100vh',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(AppBar,{position:\"static\",color:\"default\",elevation:1,children:/*#__PURE__*/_jsxs(Toolbar,{variant:\"dense\",children:[/*#__PURE__*/_jsx(IconButton,{edge:\"start\",onClick:handleToggleSidebar,\"aria-label\":\"toggle sidebar\",sx:{mr:2},children:/*#__PURE__*/_jsx(MenuIcon,{})}),/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{flexGrow:1,fontSize:'1rem'},children:[\"Sprkz PDF Forms\",pdfDoc&&/*#__PURE__*/_jsxs(Typography,{component:\"span\",variant:\"body2\",sx:{ml:2,color:'text.secondary'},children:[\"Page \",currentPage,\" of \",pdfDoc.numPages]})]}),wizard.state.totalRequiredFields>0&&/*#__PURE__*/_jsx(Box,{sx:{mr:2},children:/*#__PURE__*/_jsx(WizardButton,{size:\"small\",showProgress:false,showGuidance:false})}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsx(IconButton,{onClick:handlePreviousPage,disabled:currentPage<=1,size:\"small\",children:/*#__PURE__*/_jsx(NavigateBefore,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:handleNextPage,disabled:!pdfDoc||currentPage>=pdfDoc.numPages,size:\"small\",children:/*#__PURE__*/_jsx(NavigateNext,{})}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mx:1,minWidth:60,textAlign:'center'},children:[Math.round(scale*100),\"%\"]}),/*#__PURE__*/_jsx(IconButton,{onClick:handleZoomOut,disabled:scale<=0.5,size:\"small\",children:/*#__PURE__*/_jsx(ZoomOut,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:handleZoomIn,disabled:scale>=3.0,size:\"small\",children:/*#__PURE__*/_jsx(ZoomIn,{})})]})]})}),error&&/*#__PURE__*/_jsxs(Alert,{severity:\"error\",onClose:handleCloseError,sx:{m:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:(error.type||'Unknown Error').replace(/_/g,' ').toLowerCase().replace(/\\b\\w/g,l=>l.toUpperCase())}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:error.message})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flex:1,overflow:'hidden'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(ThumbnailSidebar,{pdfDoc:pdfDoc,currentPage:currentPage,completedPages:completedPages,pagesWithFormFields:pagesWithFormFields,onPageSelect:handlePageSelect,open:sidebarOpen,onToggle:handleToggleSidebar}),sidebarOpen&&!isMobile&&wizard.state.totalRequiredFields>0&&/*#__PURE__*/_jsx(Box,{sx:{width:160,p:1,borderTop:'1px solid',borderColor:'divider'},children:/*#__PURE__*/_jsx(ProgressTracker,{compact:false,showFieldList:false,showStats:true})})]}),/*#__PURE__*/_jsx(Box,{sx:{flex:1,display:'flex',justifyContent:'center',alignItems:'flex-start',overflow:'auto',backgroundColor:'grey.100',p:2},children:/*#__PURE__*/_jsx(PDFViewer,{// Stabilize component with key\nurl:pdfUrl,scale:scale,currentPage:currentPage,onDocumentLoad:handleDocumentLoad,onPageLoad:handlePageLoad,onError:handleError},pdfUrl)})]}),/*#__PURE__*/_jsx(Snackbar,{open:Boolean(snackbarMessage),autoHideDuration:4000,onClose:handleCloseSnackbar,message:snackbarMessage,anchorOrigin:{vertical:'bottom',horizontal:'center'}})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}